#!/data/data/com.termux/files/usr/bin/bash
#Created on 16/July/2017 by Ivam3
#Last update 02/dic/2018
#
#	Var
		R='\033[1;31m'
                G='\033[1;32m'
                Y='\033[1;33m'
                B='\033[1;34m'
                M='\033[1;35m'
                C='\033[1;36m'
                W='\033[0m'
		version="4.17.32"
echo $(clear)
        printf "$C"
        echo "          -{ IbyC > Metasploit } "
        echo "   -{ SO > Android - Only for Termux } "
        echo "              -{ Adapted by } "
        printf "$G"
        echo "      =============================="
        echo "      .___.                 ______,"
        echo "      |   |__ ______   ___  \_____ \ "
        echo "      |   \ \/ /\__ \ /   \   _(__ <,"
        echo "      |   |\   / __ \| Y Y \ /      \ "
        echo "      |___| \_/ (____|__|_| /______ /"
        echo "                     \/    \/      \/ "
        echo "      ====== By ___ Cinderella ======"
        echo
printf "$C"
        echo "          [---] Join me on [---]"
        echo "[-] www.youtube.com/c/ivam3bycinderella [-]"
	echo "      [-] t.me/Ivam3byCinderella [-]"
        echo "            [-] t.me/ivam3 [-]"
        sleep 1
printf "$R"
        echo
        echo "          [---] DISCLAIMER [---]"
printf "$W"
        echo "This file will install Metasploit Framework"
        echo "             version $version
        "
        echo "   If the law is violated with it's use"
        echo "   This would be the responsibility of "
        echo "         the user who handled it"
printf "$R       [-] Use At Your Own Risk [-]"
        echo
        echo
        printf "        $C Press$G enter$C to continue$W"
        read enter
printf "$W
"
#INSTALLING TERMUX REPOSITORIES
dpkg --configure -a
apt update -y && apt upgrade -y
apt autoremove
apt install -y util-linux
apt install -y autoconf util-linux bison clang coreutils axel curl findutils git apr apr-util libffi-dev libgmp-dev libpcap-dev postgresql-dev readline-dev libsqlite-dev openssl-dev libtool libxml2-dev libxslt-dev ncurses-dev pkg-config wget make ruby-dev libgrpc-dev termux-tools ncurses-utils ncurses unzip zip tar postgresql termux-elf-cleaner
echo "
"
#Dropping the garbage
if [ -d ~/metasploit-framework ]; then 
	rm -rf ~/metasploit-framework 
fi
find $HOME -name "*$version.tar.gz" -type f -delete
find $HOME -name "metasploit*" -type d -delete

#Installing metasploit-framework
printf "$B"
cd $HOME
axel --alternate https://github.com/rapid7/metasploit-framework/archive/$version.tar.gz
tar -xf $HOME/metasploit-framework-$version.tar.gz
mv $HOME/metasploit-framework-$version $HOME/metasploit-framework
rm $HOME/metasploit-framework-$version.tar.gz
cd $HOME/metasploit-framework
sed '/rbnacl/d' -i Gemfile.lock
sed '/rbnacl/d' -i metasploit-framework.gemspec

#Installing gems
printf "$G"
gem update --system
gem install bundler
sed 's|nokogiri (1.*)|nokogiri (1.8.0)|g' -i Gemfile.lock
ln -sf $PREFIX/include/libxml2/libxml $PREFIX/include/
gem install nokogiri -v 1.8.0 -- --use-system-libraries
#sed 's|grpc (.*|grpc (1.4.1)|g' -i $HOME/metasploit-framework/Gemfile.lock
#gem unpack grpc -v 1.4.1
#cd grpc-1.4.1
#curl -LO https://raw.githubusercontent.com/grpc/grpc/v1.4.1/grpc.gemspec
#curl -L https://raw.githubusercontent.com/ivam3/ivam3.github.io/master/extconf.patch
#patch -p1 < extconf.patch
#gem build grpc.gemspec
#gem install grpc-1.4.1.gem
#cd ..
#rm -r grpc-1.4.1
cd $HOME/metasploit-framework
bundle install -j5
$PREFIX/bin/find -type f -executable -exec termux-fix-shebang \{\} \;
rm ./modules/auxiliary/gather/http_pdf_authors.rb
if [ -e $PREFIX/bin/msfconsole ] || [ -L $PREFIX/bin/msfconsole ]; then
        rm $PREFIX/bin/msfconsole
fi
if [ -e $PREFIX/bin/msfvenom ] || [ -L $PREFIX/bin/msfvenom ]; then
        rm $PREFIX/bin/msfvenom
fi
ln -sf $HOME/metasploit-framework/msfconsole /data/data/com.termux/files/usr/bin/
ln -sf $HOME/metasploit-framework/msfvenom /data/data/com.termux/files/usr/bin/
termux-elf-cleaner /data/data/com.termux/files/usr/lib/ruby/gems/2.5.0/gems/pg-0.20.0/lib/pg_ext.so

#Intalling Ruby Gems Issues Resolve (RuGiR)
wget https://raw.githubusercontent.com/ivam3/ivam3.github.io/master/master/mediafire/RuGiR -O $HOME/metasploit-framework/RuGiR
chmod 777 $HOME/metasploit-framework/RuGiR

#Creating data base
printf "$Y
"
mv $HOME/metasploit-framework/database.yml $HOME/metasploit-framework/config
cd $HOME/metasploit-framework/config
mkdir -p $PREFIX/var/lib/postgresql
initdb $PREFIX/var/lib/postgresql
pg_ctl -D $PREFIX/var/lib/postgresql start
createuser msf
createdb msf_database
pg_ctl -D $PREFIX/var/lib/postgresql start
sed -i "4a pg_ctl -D $PREFIX/var/lib/postgresql start" $PREFIX/etc/bash.bashrc
sed -i "5a clear" $PREFIX/etc/bash.bashrc

#ENDING SCRIPT
printf "$C

#-----THANKS TO MY MASTER CINDERELLA-----#
#                                        #
#             People don't die           #
#    If they still live in the hearts    #
#           of their loved ones          #
#       We love her ... We miss her      #
#                                        #
#-------------------RIP------------------#"
sleep 3
printf "\n$C :::::::::: Running Metasploit ::::::::::$W"

	if [ -e $PREFIX/bin/msfconsole ] && [ -e $PREFIX/bin/msfvenom ]; then
		echo
		cd $HOME/metasploit-framework
		printf "$G Let's try to run msfconsole$W"
		msfconsole
	else
		echo
		cd $HOME/metasploit-framework
		printf "$G Let's try to run msfconsole$W"
                ruby msfconsole
	fi
echo "
"
printf "$W If msfconsole or msfvenom didn't run
please execute the file RuGiR
(Ruby Gem issues Resolved) 
to try to fix it with an other steps

$G => sh RuGiR$W
\n"
#						IbyC
